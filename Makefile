# Garage Barbershop - Makefile –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

.PHONY: test test-unit test-integration test-e2e test-all build run clean

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
test-all: test-unit test-integration test-e2e

# –Æ–Ω–∏—Ç —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
test-unit:
	@echo "üß™ –ó–∞–ø—É—Å–∫ —é–Ω–∏—Ç —Ç–µ—Å—Ç–æ–≤..."
	go test -v ./tests/unit/... -short

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (API, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
test-integration:
	@echo "üîó –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤..."
	go test -v ./tests/integration/... -timeout 30s

# E2E —Ç–µ—Å—Ç—ã (–ø–æ–ª–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)
test-e2e:
	@echo "üåê –ó–∞–ø—É—Å–∫ E2E —Ç–µ—Å—Ç–æ–≤..."
	go test -v ./tests/e2e/... -timeout 60s

# –í—Å–µ —Ç–µ—Å—Ç—ã
test:
	@echo "üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤..."
	go test -v ./tests/... -timeout 120s

# –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
build:
	@echo "üî® –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
	go build -o main .

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
run:
	@echo "üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
	go run main.go

# –û—á–∏—Å—Ç–∫–∞
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞..."
	rm -f main
	go clean

# –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
coverage:
	@echo "üìä –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏..."
	go test -v ./tests/... -coverprofile=coverage.out
	go tool cover -html=coverage.out -o coverage.html
	@echo "üìÑ –û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ coverage.html"

# –õ–∏–Ω—Ç–∏–Ω–≥
lint:
	@echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞..."
	golangci-lint run

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
fmt:
	@echo "‚ú® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞..."
	go fmt ./...

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
deps:
	@echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
	go mod tidy
	go mod download

# –ü–æ–º–æ—â—å
help:
	@echo "üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "  test-unit        - –Æ–Ω–∏—Ç —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ)"
	@echo "  test-integration - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (API)"
	@echo "  test-e2e         - E2E —Ç–µ—Å—Ç—ã (–ø–æ–ª–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)"
	@echo "  test-all         - –í—Å–µ —Ç–µ—Å—Ç—ã"
	@echo "  test             - –í—Å–µ —Ç–µ—Å—Ç—ã (–∫—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è)"
	@echo "  build            - –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
	@echo "  run              - –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
	@echo "  clean            - –û—á–∏—Å—Ç–∫–∞"
	@echo "  coverage         - –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è"
	@echo "  lint             - –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞"
	@echo "  fmt              - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
	@echo "  deps             - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
	@echo "  help             - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞"
